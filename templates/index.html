<!DOCTYPE html>
<html lang = "it">
    <head>
        <meta charset = "UTF-8">
        <title>Gioca SenzaMazzo.it</title>
        <meta name = "theme-color" content = "#1f2324">
        <link rel = "icon" href = "static/assets/icons/favicon.png">
        <meta name = "viewport" content = "width = device-width, initial-scale = 1">
        <meta name = "description" content = "Gioca con i tuo amici a qualsiasi gioco di carte senza la necessitÃ  di avere un mazzo di carte a portata di mano!">

        <link rel = "stylesheet" href = "static/css/min/mobile-small.min.css" media = "screen and (max-width: 320px)">
        <link rel = "stylesheet" href = "static/css/min/mobile-medium.min.css" media = "screen and (min-width: 321px) and (max-width: 375px)">
        <link rel = "stylesheet" href = "static/css/min/mobile-large.min.css" media = "screen and (min-width: 376px) and (max-width: 425px)">
        <link rel = "stylesheet" href = "static/css/min/tablet.min.css" media = "screen and (min-width: 426px) and (max-width: 768px)">
        <link rel = "stylesheet" href = "static/css/min/pc.min.css" media = "screen and (min-width: 769px)">

        <link rel = "preconnect" href = "https://fonts.googleapis.com">
        <link rel = "preconnect" href = "https://fonts.gstatic.com" crossorigin>
        <link href = "https://fonts.googleapis.com/css2?family=Alata&family=Outfit&display=swap" rel = "stylesheet">

        <script src = "https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

        <script src = "https://cdn.jsdelivr.net/npm/socket.io@4.7.2/client-dist/socket.io.min.js"></script>
    </head>
    <body>
        <div id = "a">
            <div id = "b">
                <section>
                    <h3>TAVOLO</h3>
                    <div class = "view" id = "drop"></div>
                </section>
    
                <section>
                    <h3>MANO</h3>
                    <div class = "view" id = "hand"></div>
                </section>
            </div>
            <section>
                <h3>AZIONI</h3>
            </section>
        </div>
        <div id = "c">
            <textarea id = "public_notes" rows = "4" cols = "40" placeholder = "Note condivise"></textarea>
            <textarea rows = "4" cols = "40" placeholder = "Note personali"></textarea>

        </div>





        <!-- <section>
            
            <table border = "2">
                <tr>
                    <th>CALA A TERRA DA</th>
                    <th>PRENDI IN MANO DA</th>
                    <th>RIPONI NEL MAZZO DA</th>
                    <th>AGGIUNGI AI PUNTI DA</th>
                    <th>DAI AD UN'ALTRA MANO DA</th>
                    <th>SISTEMA CARTE</th>
                    <th>VEDI CARTE</th>
                    <th>FAI VEDERE</th>
                    <th>MISCHIA</th>
                    <th>ESCLUDI CARTE</th>
                </tr>
                <tr>
                    <td>
                        <button id = "deck_to_drop">
                            <img src = "static/assets/icons/deck.png" alt = "deck">
                        </button>
                    </td>
                    <td>
                        <button id = "deck_to_hand">
                            <img src = "static/assets/icons/deck.png" alt = "deck">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_deck">
                            <img src = "static/assets/icons/hand.png" alt = "deck">
                        </button>
                    </td>
                    <td>
                        <button id = "deck_to_loot">PT</button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/hand.png" alt = "hand">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/drop.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/deck.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/hand.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/deck.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/deck.png" alt = "drop">
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id = "hand_to_drop">
                            <img src = "static/assets/icons/hand.png" alt = "hand">

                        </button>
                    </td>
                    <td>
                        <button id = "drop_to_hand">
                            <img src = "static/assets/icons/drop.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "drop_to_deck">
                            <img src = "static/assets/icons/drop.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/drop.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">PT</button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/hand.png" alt = "drop">
                        </button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">PT</button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">PT</button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/hand.png" alt = "drop">
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id = "loot_to_drop">PT</button>
                    </td>
                    <td>
                        <button id = "loot_to_hand">PT</button>
                    </td>
                    <td>
                        <button id = "loot_to_deck">PT</button>
                    </td>
                    <td>
                        <button id = "hand_to_loot">
                            <img src = "static/assets/icons/hand.png" alt = "drop">
                        </button>
                    </td>
                </tr>
            </table>
        </section> -->

        <script type = "text/javascript">

            $(document).ready(function () {

                $("#qr").click(function () {
                    navigator.clipboard.writeText("http://127.0.0.1:5000/{{room}}");
                });

                var socket = io(window.location.host);
                const room = "{{room}}";

                socket.on("connect", function () {
                    socket.emit("join", { room: room, user: socket.id });
                });

                socket.on("public_notes", function (data) {
                    $("#public_notes").val(data.text);
                });

                socket.on("pick", function (data) {
                    $("#hand").append(`<img class = "clickable" src = "static/assets/deck/${data.card}.jpg" alt = "${data.card}">`);
                });

                socket.on("drop", function (data) {
                    $("#drop").html(
                        data.cards.map(function (card) {
                            return `<img class = "clickable" src = "static/assets/deck/${card}.jpg" alt = "${card}">`;
                        }).join('')
                    );
                });

                socket.on("void", function () {
                    $("#deck_to_hand").prop("disabled", true);
                    $("#deck_to_drop").prop("disabled", true);
                });



                $("#public_notes").on("blur", function() {
                    socket.emit("public_notes", { room: room, text: $(this).val()});
                });

                $("#deck_to_drop").click(function () {
                    socket.emit("deck_to_drop", { room: room });
                });

                $("#deck_to_hand").click(function () {
                    socket.emit("deck_to_hand", { room: room, user: socket.id });
                });

                $("#hand").on("click", ".clickable", function () {
                    var card = $(this);
                    if (card.css("opacity") == 1) {
                        card.css("opacity", 0.5);
                    } else {
                        card.css("opacity", 1);
                    }
                });

                $("#drop").on("click", ".clickable", function () {
                    var card = $(this);
                    if (card.css("opacity") == 1) {
                        card.css("opacity", 0.5);
                    } else {
                        card.css("opacity", 1);
                    }
                });

                $("#hand_to_drop").click(function () {
                    $("#hand img").filter(function () {
                        return $(this).css("opacity") === "0.5";
                    }).each(function () {
                        socket.emit("hand_to_drop", { room: room, card: $(this).attr("src").split("/").pop().split(".")[0] });
                        $(this).remove();
                    });
                });

                $("#drop_to_hand").click(function () {
                    $("#drop img").filter(function () {
                        return $(this).css("opacity") === "0.5";
                    }).each(function () {
                        socket.emit("drop_to_hand", { room: room, user: socket.id, card: $(this).attr("src").split("/").pop().split(".")[0] });
                        $(this).remove();
                    });
                });

            });

        </script>

    </body>
</html>