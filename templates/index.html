<!DOCTYPE html>
<html lang = "it">
    <head>
        <meta charset = "UTF-8">
        <title>SenzaMazzo.it</title>
        <link rel = "manifest" href = "manifest.json">
        <meta name = "theme-color" content = "#1f2324">
        <link rel = "icon" href = "static/assets/icons/favicon.png">
        <link rel = "stylesheet" href = "static/css/min/style.min.css">
        <meta name = "viewport" content = "width = screen-width, initial-scale = 1">
        <meta name = "description" content = "Gioca con i tuo amici a qualsiasi gioco di carte senza la necessitÃ  di avere un mazzo di carte a portata di mano!">

        <link rel = "preconnect" href = "https://fonts.googleapis.com">
        <link rel = "preconnect" href = "https://fonts.gstatic.com" crossorigin>
        <link rel = "stylesheet" href = "https://fonts.googleapis.com/css2?family=Alata&family=Outfit&display=swap">

        <script type = "text/javascript">navigator.serviceWorker.register("service-worker.js")</script>

        <script src = "https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
        <script src = "https://cdn.jsdelivr.net/npm/socket.io@4.7.2/client-dist/socket.io.min.js"></script>
    </head>
    <body>

            <div id = "b">
                <div>
                    <h3>TAVOLO</h3>
                    <div class = "view" id = "drop"></div>
                </div>
                <div>
                    <h3>MANO</h3>
                    <div class = "view" id = "hand"></div>
                </div>
                <div>
                    <textarea id = "public_notes" rows = "4" cols = "40" placeholder = "Note condivise"></textarea>
                    <textarea rows = "4" cols = "40" placeholder = "Note personali"></textarea>
                </div>
            </div>
            <div id = c>
                <h3>AZIONI</h3>
                <table>
                    <tr>
                        <th>CALA A TERRA DA</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>PRENDI IN MANO DA</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                        <td><img src = "static/assets/icons/drop.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>RIPONI NEL MAZZO DA</th>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/drop.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>AGGIUNGI AI PUNTI DA</th>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/drop.png" alt = ""></td>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>DAI AD UNA MANO DA</th>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>SISTEMA LE CARTE</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/drop.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>VEDI LE CARTE</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>FAI VEDERE LE CARTE</th>
                        <td><img src = "static/assets/icons/hand.png" alt = ""></td>
                        <td><img src = "static/assets/icons/points.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>MISCHIA LE CARTE</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                    </tr>
                    <tr>
                        <th>ESCLUDI DELLE CARTE</th>
                        <td><img src = "static/assets/icons/deck.png" alt = ""></td>
                    </tr>
                </table>
            </div>


        <script type = "text/javascript">

            $(document).ready(function () {

                $("#qr").click(function () {
                    navigator.clipboard.writeText("http://127.0.0.1:5000/{{room}}");
                });

                var socket = io(window.location.host);
                const room = "{{room}}";

                socket.on("connect", function () {
                    socket.emit("join", { room: room, user: socket.id });
                });

                socket.on("public_notes", function (data) {
                    $("#public_notes").val(data.text);
                });

                socket.on("pick", function (data) {
                    $("#hand").append(`<img class = "clickable" src = "static/assets/deck/${data.card}.jpg" alt = "${data.card}">`);
                });

                socket.on("drop", function (data) {
                    $("#drop").html(
                        data.cards.map(function (card) {
                            return `<img class = "clickable" src = "static/assets/deck/${card}.jpg" alt = "${card}">`;
                        }).join('')
                    );
                });

                socket.on("void", function () {
                    $("#deck_to_hand").prop("disabled", true);
                    $("#deck_to_drop").prop("disabled", true);
                });



                $("#public_notes").on("blur", function() {
                    socket.emit("public_notes", { room: room, text: $(this).val()});
                });

                $("#deck_to_drop").click(function () {
                    socket.emit("deck_to_drop", { room: room });
                });

                $("#deck_to_hand").click(function () {
                    socket.emit("deck_to_hand", { room: room, user: socket.id });
                });

                $("#hand").on("click", ".clickable", function () {
                    var card = $(this);
                    if (card.css("opacity") == 1) {
                        card.css("opacity", 0.5);
                    } else {
                        card.css("opacity", 1);
                    }
                });

                $("#drop").on("click", ".clickable", function () {
                    var card = $(this);
                    if (card.css("opacity") == 1) {
                        card.css("opacity", 0.5);
                    } else {
                        card.css("opacity", 1);
                    }
                });

                $("#hand_to_drop").click(function () {
                    $("#hand img").filter(function () {
                        return $(this).css("opacity") === "0.5";
                    }).each(function () {
                        socket.emit("hand_to_drop", { room: room, card: $(this).attr("src").split("/").pop().split(".")[0] });
                        $(this).remove();
                    });
                });

                $("#drop_to_hand").click(function () {
                    $("#drop img").filter(function () {
                        return $(this).css("opacity") === "0.5";
                    }).each(function () {
                        socket.emit("drop_to_hand", { room: room, user: socket.id, card: $(this).attr("src").split("/").pop().split(".")[0] });
                        $(this).remove();
                    });
                });

            });

        </script>

    </body>
</html>